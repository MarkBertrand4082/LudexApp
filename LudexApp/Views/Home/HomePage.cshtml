@model LudexApp.Models.ViewModels.HomePageViewModel

@{
    ViewData["Title"] = "Ludex - Home";
}

<h1>Welcome to Ludex</h1>

<hr />

<!-- ================================================== -->
<!-- LOGIN STATUS / NAVIGATION -->
<!-- ================================================== -->
@if (!Model.IsLoggedIn)
{
    <p>You are currently browsing as a guest.</p>

    <!-- Login / Register as a GET form with button -->
    <form asp-action="GoToLogin" method="get">
        <button type="submit" class="btn btn-primary">
            Login / Register
        </button>
    </form>
}
else
{
    <p>Welcome back!</p>

    <!-- Logout should remain POST -->
    <form asp-controller="Home" asp-action="Logout" method="post">
        <button type="submit" class="btn btn-danger">
            Logout
        </button>
    </form>
}

<hr />

<!-- ================================================== -->
<!-- FEATURED GAMES -->
<!-- ================================================== -->
<h2>Featured Games</h2>

@if (Model.FeaturedGames == null || !Model.FeaturedGames.Any())
{
    <p>No featured games available.</p>
}
else
{
    <div>
        @foreach (var g in Model.FeaturedGames)
        {
            <div class="card mb-2" style="padding: 10px;">
                <h3>@g.Title</h3>

                @if (!string.IsNullOrEmpty(g.Platform))
                {
                    <p><strong>Platforms:</strong> @g.Platform</p>
                }

                @if (g.AverageRating.HasValue)
                {
                    <p>
                        <strong>Rating:</strong>
                        @((g.AverageRating.Value / 20.0).ToString("0.0")) ⭐
                    </p>
                }

                <!-- View Game button (GET) -->
                <form asp-controller="Game"
                      asp-action="Details"
                      method="get">
                    <input type="hidden" name="id" value="@g.GameId" />
                    <button type="submit" class="btn btn-info">
                        View Game
                    </button>
                </form>
            </div>
        }
    </div>
}

<hr />

<!-- ================================================== -->
<!-- USER EXCLUSIVE CONTENT -->
<!-- ================================================== -->
@if (Model.IsLoggedIn)
{
    <h2>Your Game Library</h2>

    @if (Model.UserGameList == null || !Model.UserGameList.Any())
    {
        <p>No games saved yet.</p>
    }
    else
    {
        <ul>
            @foreach (var g in Model.UserGameList)
            {
                <li>
                    <strong>@g.Title</strong>

                    <!-- View Game button for library entry -->
                    <form asp-controller="Game"
                          asp-action="Details"
                          method="get"
                          class="d-inline">
                        <input type="hidden" name="id" value="@g.GameId" />
                        <button type="submit"
                                class="btn btn-sm btn-outline-secondary">
                            View
                        </button>
                    </form>
                </li>
            }
        </ul>
    }

    <!-- Open full Game Library -->
    <form asp-controller="Game" asp-action="Index" method="get">
        <button type="submit" class="btn btn-primary mt-2">
            Open Game Library
        </button>
    </form>

    <hr />

    <h2>Your Friends</h2>

    @if (Model.Friends == null || !Model.Friends.Any())
    {
        <p>You have no friends added.</p>
    }
    else
    {
        <ul>
            @foreach (var f in Model.Friends)
            {
                <li>
                    <strong>@f.Username</strong> —
                    Games in common: @f.SharedGamesCount
                </li>
            }
        </ul>
    }

    <!-- View friend list -->
    <form asp-controller="User" asp-action="Friends" method="get">
        <button type="submit" class="btn btn-secondary mt-2">
            View Friend List
        </button>
    </form>
}

<hr />
